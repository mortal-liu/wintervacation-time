<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#2563eb">
    <title>寒假课表</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/2232/2232688.png">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2232/2232688.png">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet" />
    <style>
        body { background-color: #f3f4f6; font-family: 'Inter', 'Noto Sans SC', sans-serif; -webkit-tap-highlight-color: transparent; }
        .completed { opacity: 0.4; filter: grayscale(1); border-style: dashed !important; }
        .completed .status-badge { background-color: #6b7280 !important; }
        #progress-bar { transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        /* 预留出顶部导航栏的空间，防止定位后标题被挡住 */
        section, .task-card { 
            scroll-margin-top: 240px; 
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="pb-16">

    <div class="sticky top-0 z-30 bg-white/95 backdrop-blur-md border-b-2 border-gray-200 shadow-md">
        <div class="max-w-md mx-auto px-6 py-6">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-3xl font-black text-gray-900 tracking-tighter">2026 1.15-2.03 寒假</h1>
                    <p class="text-base text-gray-500 font-bold uppercase tracking-widest">学习进度追踪</p>
                </div>
                <span id="progress-percent" class="text-4xl font-black text-blue-600 italic">0%</span>
            </div>
            
            <div class="flex flex-nowrap gap-1 mb-6">
                <span class="px-1.5 py-1 rounded-lg bg-blue-100 text-blue-700 text-xs font-bold border border-blue-200 whitespace-nowrap">数 40min</span>
                <span class="px-1.5 py-1 rounded-lg bg-orange-100 text-orange-700 text-xs font-bold border border-orange-200 whitespace-nowrap">休 10min</span>
                <span class="px-1.5 py-1 rounded-lg bg-blue-100 text-blue-700 text-xs font-bold border border-blue-200 whitespace-nowrap">数 40min</span>
                <span class="px-1.5 py-1 rounded-lg bg-orange-100 text-orange-700 text-xs font-bold border border-orange-200 whitespace-nowrap">休 10min</span>
                <span class="px-1.5 py-1 rounded-lg bg-green-100 text-green-700 text-xs font-bold border border-green-200 whitespace-nowrap">物 50min</span>
            </div>

            <div class="w-full bg-gray-200 rounded-full h-4 border border-gray-300 p-1">
                <div id="progress-bar" class="bg-blue-600 h-2 rounded-full shadow-[0_0_12px_rgba(37,99,235,0.4)]" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <div class="max-w-md mx-auto px-4 mt-8">
        <div id="schedule-content" class="space-y-12"></div>
    </div>

    <script>
        // 日期已修正：1.15 是周四
        const scheduleData = [
            { phase: "第一阶段：方程与力学", days: [
                { id: "1-15", date: "01.15", day: "周四", content: ["数学：复习二次根式", "物理：力的定义与分类"] },
                { id: "1-16", date: "01.16", day: "周五", content: ["数学：一元二次方程定义", "物理：受力分解基础"] },
                { id: "1-17", date: "01.17", day: "周六", content: ["数学：一元二次方程解法", "物理：牛顿第一定律"] },
                { id: "1-18", date: "01.18", day: "周日", content: ["数学：一元二次方程应用", "物理：牛顿第二定律"] },
                { id: "1-19", date: "01.19", day: "周一", content: ["阶段测试 01：方程与力学"], isTest: true }
            ]},
            { phase: "第二阶段：几何与压强浮力", days: [
                { id: "1-20", date: "01.20", day: "周二", content: ["数学：勾股定理公式", "物理：压强定义及表达式"] },
                { id: "1-21", date: "01.21", day: "周三", content: ["数学：勾股定理应用", "物理：大气与液体压强"] },
                { id: "1-22", date: "01.22", day: "周四", content: ["数学：平行四边形性质", "物理：浮力定义与公式"] },
                { id: "1-23", date: "01.23", day: "周五", content: ["数学：中位线定理", "物理：物体沉浮条件"] },
                { id: "1-24", date: "01.24", day: "周六", content: ["阶段测试 02：几何与浮力"], isTest: true }
            ]},
            { phase: "第三阶段：数据分析与机械能", days: [
                { id: "1-25", date: "01.25", day: "周日", content: ["数学：加权平均数", "物理：功的定义与公式"] },
                { id: "1-26", date: "01.26", day: "周一", content: ["数学：中位数与众数", "物理：功率计算"] },
                { id: "1-27", date: "01.27", day: "周二", content: ["数学：方差计算", "物理：动能与势能"] },
                { id: "1-28", date: "01.28", day: "周三", content: ["数学：方差的应用", "物理：机械能转化"] },
                { id: "1-29", date: "01.29", day: "周四", content: ["阶段测试 03：数据与能量"], isTest: true }
            ]},
            { phase: "第四阶段：一次函数与机械", days: [
                { id: "1-30", date: "01.30", day: "周五", content: ["数学：一次函数基础", "物理：杠杆的定义"] },
                { id: "1-31", date: "01.31", day: "周六", content: ["数学：一次函数图像", "物理：杠杆的应用"] },
                { id: "2-01", date: "02.01", day: "周日", content: ["数学：一次函数解析式", "物理：简单机械效率"] },
                { id: "2-02", date: "02.02", day: "周一", content: ["数学：函数综合实战", "物理：滑轮组的作用"] },
                { id: "2-03", date: "02.03", day: "周二", content: ["阶段测试 04：函数与机械"], isTest: true }
            ]}
        ];

        let completed = JSON.parse(localStorage.getItem('gz_completed')) || [];

        function render() {
            const container = document.getElementById('schedule-content');
            container.innerHTML = scheduleData.map(phase => `
                <section id="section-${phase.phase}">
                    <h2 class="text-lg font-black text-gray-500 uppercase tracking-widest mb-6 flex items-center px-2">
                        <span class="w-10 h-1 bg-blue-500 mr-3 rounded"></span> ${phase.phase}
                    </h2>
                    <div class="grid gap-6">
                        ${phase.days.map(d => {
                            const isDone = completed.includes(d.id);
                            return `
                                <div id="card-${d.id}" onclick="toggle('${d.id}')" class="task-card group bg-white border-2 ${d.isTest ? 'border-red-200 bg-red-50/30' : 'border-white'} p-6 rounded-3xl shadow-md transition-all active:scale-[0.98] ${isDone ? 'completed' : ''}">
                                    <div class="flex justify-between items-center mb-4">
                                        <div class="flex items-center">
                                            <span class="text-2xl font-black ${d.isTest ? 'text-red-700' : 'text-gray-900'}">${d.date}</span>
                                            <span class="text-base ml-3 text-gray-400 font-bold">${d.day}</span>
                                        </div>
                                        <span class="status-badge px-3 py-1 rounded-lg text-sm font-black ${d.isTest ? 'bg-red-600 text-white' : 'bg-blue-600 text-white'}">
                                            ${isDone ? '已完成' : (d.isTest ? '考试' : '待学习')}
                                        </span>
                                    </div>
                                    <ul class="space-y-3">
                                        ${d.content.map(c => `
                                            <li class="text-lg font-bold text-gray-700 flex items-start">
                                                <span class="mt-2 w-2 h-2 rounded-full ${d.isTest ? 'bg-red-400' : 'bg-blue-400'} mr-3 shrink-0"></span> 
                                                <span>${c}</span>
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </section>
            `).join('');
            updateProgress();
        }

        function toggle(id) {
            const idx = completed.indexOf(id);
            let isMarkingDone = false;
            if (idx === -1) {
                completed.push(id);
                isMarkingDone = true;
                if (navigator.vibrate) navigator.vibrate(60);
            } else {
                completed.splice(idx, 1);
            }
            localStorage.setItem('gz_completed', JSON.stringify(completed));
            render();
            if (isMarkingDone) {
                setTimeout(() => autoScroll(), 400); 
            }
        }

        function updateProgress() {
            const total = scheduleData.reduce((acc, p) => acc + p.days.length, 0);
            const percent = Math.round((completed.length / total) * 100);
            document.getElementById('progress-bar').style.width = percent + '%';
            document.getElementById('progress-percent').innerText = percent + '%';
        }

        // 核心优化：增强型自动定位逻辑
        function autoScroll() {
            let targetCard = null;
            let targetSection = null;
            let isFirstInPhase = false;

            // 寻找第一个待学习的任务
            for (let phase of scheduleData) {
                const firstUnfinished = phase.days.find(d => !completed.includes(d.id));
                if (firstUnfinished) {
                    targetCard = document.getElementById(`card-${firstUnfinished.id}`);
                    if (firstUnfinished.id === phase.days[0].id) {
                        isFirstInPhase = true;
                        targetSection = document.getElementById(`section-${phase.phase}`);
                    }
                    break;
                }
            }

            if (targetCard) {
                const scrollElement = isFirstInPhase ? targetSection : targetCard;
                // 使用 block: 'start' 确保任务被顶到最上方
                scrollElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                targetCard.classList.add('ring-4', 'ring-blue-400', 'ring-opacity-50');
                setTimeout(() => targetCard.classList.remove('ring-4', 'ring-blue-400', 'ring-opacity-50'), 1500);
            }
        }

        // 核心优化：监听“切回应用”事件，实现自动对齐
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                autoScroll();
            }
        });

        render();
        // 增加延迟，确保移动端浏览器渲染完毕后再定位
        window.addEventListener('load', () => {
            setTimeout(autoScroll, 600);
        });
    </script>
</body>
</html>